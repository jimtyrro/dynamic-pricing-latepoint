"use strict";class TechXelaLatePointQuickSmsAdmin{constructor(){this.observableCalendarClasses=[".agents-timelines-w",".calendar-daily-agent-w",".calendar-week-agent-w",".calendar-month-agents-w"],this.bookingBoxClassMappings=[{container:".booking-block",subContainer:".appointment-box-small",parentCalendars:[".agents-timelines-w"]},{container:".ch-day-booking",subContainer:".ch-day-booking-i",parentCalendars:[".calendar-daily-agent-w",".calendar-week-agent-w"]},{container:".ma-day-booking",subContainer:".appointment-box-small",parentCalendars:[".calendar-month-agents-w"]}],this.ready()}ready(){jQuery(document).ready((()=>{let e=this;this.bookingBoxClassMappings.forEach((e=>{this.maybeAddSendButtonToBookingBox(e.container,e.subContainer)})),this.observableCalendarClasses.forEach((e=>{jQuery(".latepoint-content "+e).length&&this.setupBookingBoxObserver(e)})),jQuery(".latepoint-content-w").on("click",".tx-qsms-booking-box-send-btn",(t=>{t.stopPropagation();let a=jQuery(t.currentTarget);if(a.hasClass("os-loading"))return!1;a.addClass("os-loading");let n={action:"latepoint_route_call",route_name:latepoint_helper.techxela_qsms_send_form_route,params:a.data("tx-params"),return_format:"json"};return techXelaLatePointCoreAdmin.clearAdminNotifs(),jQuery.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:n,success:function(t){"success"===t.status?(latepoint_show_data_in_lightbox(t.message),e.initSendForm(a)):latepoint_add_notification(t.message,"error"),a.removeClass("os-loading")}}),!1}))}))}setupBookingBoxObserver(e){let t=jQuery(".latepoint-content");const a=this;new MutationObserver((function(t){t.forEach((function(t){"childList"===t.type&&a.bookingBoxClassMappings.forEach((t=>{t.parentCalendars.includes(e)&&a.maybeAddSendButtonToBookingBox(t.container,t.subContainer)}))}))})).observe(t[0],{childList:!0,subtree:!0})}maybeAddSendButtonToBookingBox(e,t){for(const a of jQuery(e)){let e=jQuery(a).find(t);if(!e.find(".tx-qsms-booking-box-send-btn").length){e.append(latepoint_helper.techxela_qsms_quick_sms_btn_html);let t=jQuery(a).find(".tx-qsms-booking-box-send-btn");if(t.length&&(t.attr("data-tx-id",techXelaLatePointCoreAdmin.randNum(1)),t.attr("data-tx-params",jQuery(a).data("os-params")),latepoint_helper.techxela_qsms_indicate_sent)){t.addClass("os-loading");let e={action:"latepoint_route_call",route_name:latepoint_helper.techxela_qsms_send_count_route,params:t.data("tx-params"),return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:e,success:function(e){e.message>0&&t.hasClass("latepoint-btn-primary")&&!t.hasClass("latepoint-btn-success")&&(t.addClass("latepoint-btn-success"),t.removeClass("latepoint-btn-primary")),t.removeClass("os-loading")}})}}}}initSendForm(e){void 0!==e&&jQuery(".tx-qsms-send-form form #booking_id").after(`<input type="hidden" name="tx_from_btn_id" value="${e.data("tx-id")}">`),jQuery(".tx-qsms-send-form").on("change",".tx-qsms-sf-template-select",(e=>{let t=jQuery(e.currentTarget).val();if(t.length){let a={action:"latepoint_route_call",route_name:latepoint_helper.techxela_qsms_get_template_content_route,params:"id="+t,return_format:"json"};techXelaLatePointCoreAdmin.clearAdminNotifs(),jQuery.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:a,success:function(t){"success"===t.status?jQuery(e.currentTarget).closest(".tx-qsms-send-form").find(".tx-qsms-sf-message-field").val(t.message):latepoint_add_notification(t.message,"error")}})}else jQuery(e.currentTarget).closest(".tx-qsms-send-form").find(".tx-qsms-sf-message-field").val("")}))}checkSentCount(e){let t=jQuery(`a[data-tx-id="${e.from_btn_id}"`);if(t.hasClass("latepoint-btn-primary")&&!t.hasClass("latepoint-btn-success")){t.addClass("os-loading");let e={action:"latepoint_route_call",route_name:latepoint_helper.techxela_qsms_send_count_route,params:t.data("tx-params"),return_format:"json"};return jQuery.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:e,success:function(e){e.message>0&&(t.addClass("latepoint-btn-success"),t.removeClass("latepoint-btn-primary")),t.removeClass("os-loading"),t.click()}}),!1}t.click(),setTimeout((()=>{latepoint_add_notification(e.message,e.status)}),1500)}}window.techXelaLatePointQuickSmsAdmin=new TechXelaLatePointQuickSmsAdmin,window.txQsmsCheckSentCount=techXelaLatePointQuickSmsAdmin.checkSentCount;
//# sourceMappingURL=quick-sms-admin.min.js.map